`timescale 1ns / 1ps

module core_top(
    input  wire        aclk,
    input  wire        aresetn,
    input  wire [ 7:0] intrpt, 
    //AXI interface 
    //read reqest
    output wire [ 3:0] arid,
    output wire [31:0] araddr,
    output wire [ 7:0] arlen,
    output wire [ 2:0] arsize,
    output wire [ 1:0] arburst,
    output wire [ 1:0] arlock,
    output wire [ 3:0] arcache,
    output wire [ 2:0] arprot,
    output wire        arvalid,
    input  wire        arready,
    //read back
    input  wire [ 3:0] rid,
    input  wire [31:0] rdata,
    input  wire [ 1:0] rresp,
    input  wire        rlast,
    input  wire        rvalid,
    output wire        rready,
    //write request
    output wire [ 3:0] awid,
    output wire [31:0] awaddr,
    output wire [ 7:0] awlen,
    output wire [ 2:0] awsize,
    output wire [ 1:0] awburst,
    output wire [ 1:0] awlock,
    output wire [ 3:0] awcache,
    output wire [ 2:0] awprot,
    output wire        awvalid,
    input  wire        awready,
    //write data
    output wire [ 3:0] wid,
    output wire [31:0] wdata,
    output wire [ 3:0] wstrb,
    output wire        wlast,
    output wire        wvalid,
    input  wire        wready,
    //write back
    input  wire [ 3:0] bid,
    input  wire [ 1:0] bresp,
    input  wire        bvalid,
    output wire        bready,

    // debug
    
    input           break_point,    //æ— éœ€å®ç°åŠŸèƒ½ï¼Œä»…æä¾›æ¥å£å³å¯ï¼Œè¾“å…?1â€™b0
    input           infor_flag,     //æ— éœ€å®ç°åŠŸèƒ½ï¼Œä»…æä¾›æ¥å£å³å¯ï¼Œè¾“å…?1â€™b0
    input  [ 4:0]   reg_num,        //æ— éœ€å®ç°åŠŸèƒ½ï¼Œä»…æä¾›æ¥å£å³å¯ï¼Œè¾“å…?5â€™b0
    output          ws_valid,       //æ— éœ€å®ç°åŠŸèƒ½ï¼Œä»…æä¾›æ¥å£å³å¯
    output [31:0]   rf_rdata,       //æ— éœ€å®ç°åŠŸèƒ½ï¼Œä»…æä¾›æ¥å£å³å¯

    output [31:0] debug0_wb_pc,
    output [ 3:0] debug0_wb_rf_wen,
    output [ 4:0] debug0_wb_rf_wnum,
    output [31:0] debug0_wb_rf_wdata

);
    wire rst;
    assign rst = !aresetn;

    wire icache_ren;
    wire [31:0] icache_araddr;
    wire icache_rvalid;
    wire [127:0] icache_rdata;
    wire dcache_ren;
    wire [31:0] dcache_araddr;
    wire dcache_rvalid;
    wire [31:0] dcache_rdata;
    wire [3:0] dcache_wen;
    wire [127:0] dcache_wdata;
    wire [31:0] dcache_awaddr;
    wire dcache_bvalid;

    //AXI communicate
    wire axi_ce_o;
    wire [3:0] axi_wsel;   
    //AXI read
    wire [31:0] axi_rdata;
    wire axi_rdata_valid;
    wire axi_ren;
    wire axi_rready;
    wire [31:0] axi_raddr;
    wire [7:0] axi_rlen;
    wire [127:0] dcache_axi_data_block;

    //AXI write
    wire axi_wdata_resp;
    wire axi_wen;
    wire [31:0] axi_waddr;
    wire [31:0] axi_wdata;
    wire axi_wvalid;
    wire axi_wlast;
    wire [7:0] axi_wlen;
    wire [1:0] cache_brust_type;
    assign cache_brust_type = 2'b01;   
    wire [2:0] cache_brust_size;
    assign cache_brust_size = 3'b010;

    //icache  é—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨æŠ½åŸ?é¡’å‚›åš?éæ°¼å¼é¡­å®îœéˆ§î„ƒçŸ¾é—å‘Šç¨‘é¡ã„©åŸ›é´ï¸½å£é–¹î…Ÿå¸’æ¿¡å¥¸æŸ¡ç€£î‚¢ç´é–ºå²‹ç´•éˆ§î„Šç¶†æµœå •æ‚¡éç¢±æ®½é–»æ„¯å°™ç» å©šæŸ¡çè¯²å¦¿é–³ÑŒå‰¨ç»²è—‰Î›éƒå‚›î‚½æ¿®æ¨¿æ³›é’ƒç†¼æŸ•æ¿ç‚¬æ«†é–¸å¬ªå«°éŒæ¶˜â˜‰å§—å å§›æ¿å¯¸å§ç€šæ¿îå¨²î„æ¶æ¤¤æ’¶å›éªå¬®æ¢ºç›â?³äº¾é—‚ä¾‡å‰™ç»‰æ’®å´’éŠŠâ•‚â’‘æ¤¤æ†å“ç¼å¤Œæ•»é®ï¿ å¦·éˆºå‚œå½é—å“„å?¹ç?µÑ‡å´¯éçƒ˜ç…ŸéŸ«å›·çµ½å¨…å¶‰æŸ¡å®€â‚¬é æ„°Ë‡é—å Ÿå„Ÿé–³ãƒ¥å•¿ç» ï½‰æ¢»æµ£èŠ¥ã€ƒé–»æç®“éªæˆ¦å´¶è¤œé¤æ›Ÿã„éºæˆî©é¥æ’®æ¢ºç»¯æ›å¢²æ¤¤ã„¥ç¹‘ç?µå¥¸å¹˜ç¼æ¨·æ‹ºé—å…¼äº½éæ—ˆå¹‹å©¢æ¿‡æ¤½é®ãˆ¤æ‚¡æ´ãˆ¢â‚¬î„„æ¢ºéŸæ¿â’”ç¼î‡…å¶å¯®æŸ¥å¹–æµ£è§„æ«¢é—è·¨å™¦é·ï¿½??**********************
    wire BPU_flush;
    wire inst_rreq;
    wire [31:0] inst_addr;
    wire [31:0] BPU_pred_addr;
    wire pi_is_exception;
    wire [6:0] pi_exception_cause; 

    wire icache_inst_valid;
    wire [31:0] pred_addr_for_buffer;
    wire [1:0] pred_taken_for_buffer;
    wire pi_icache_is_exception1;
    wire pi_icache_is_exception2;
    wire [6:0] pi_icache_exception_cause1;
    wire [6:0] pi_icache_exception_cause2;
    wire pc_suspend;
    wire [31:0] icache_pc1;
    wire [31:0] icache_pc2;
    wire [31:0] icache_inst1;
    wire [31:0] icache_inst2;
    //*************************************************


    // é—‚å‚šå€·ç»€ä¾?å¹‰é”ŸçŠ²ç®°é–¸æ¿„å„³é­æ’¶æ†¸é—å ç¬’é–ºå¬©ç·šéŒç†¼å¹‘é°é›æ®­ç¼‚ä½²å“é–¸î‚ å„²é“æ› æ†¸æ´ã„£â‚¬å†®å´±å¦¯ç¢±æ´¸é—é›ç‰†é¡¦ä¼´æ‚¡å¨†å¿£æ¸»éï½äºªé¡æ¥…æŸ›å¦¯ç»˜å°¦é–ºå±¸å‰é·å‘¯æ†´é•î‚¤ï¼“é–»åº¢î†–é£î‡?å´œé”é•ç¹†é–¸î‚£æ´–éªãˆ¡ä¿ŠéŠˆå’ƒæ¢—ç¼æ†‹ç®“å§Šæ´ªæ‡¡éŠˆå‘…ãˆ¡ç¹›ç’‡Ñ…ç•µæ¥ ç‚´åŠ™éªåº¨æŒŠæ¾¶å¬¬â‚¬î„„æ¢ºç‘™å‹«ç¤ƒæ¤¤æ›†å…¾æ¶˜îœéˆ§î„„å¼»é‡ãˆ é†‡æ¿ é›æµ‚å¦«ç‚²îœƒéŠˆå‘¯ç®°é–»æ §ã‚¸å¯®å©šæ•ƒéˆ§î„ƒç’ç¼‚å‚™ç„¦é¡­å›¬Ë‡æµ¼å­˜â’‘é‰ç‚´å£†é”å¶‰æŸŸéŸç‰ˆå–˜ç?µî‡…åŠéªæ¨¼ç´’å¦¯ç»˜î??
    wire fb_pred_taken1;
    wire fb_pred_taken2;
    wire [31:0]fb_pc1;
    wire [31:0]fb_pc2;
    wire [31:0]fb_inst1;
    wire [31:0]fb_inst2;
    wire [1:0] fb_valid;
    wire [1:0]fb_pre_taken;
    
    
    wire [31:0]fb_pre_branch_addr1;
    wire [31:0]fb_pre_branch_addr2;
    wire [1:0] fb_is_exception1;
    wire [1:0] fb_is_exception2;
    wire [6:0] fb_pc_exception_cause1;
    wire [6:0] fb_pc_exception_cause2;
    wire [6:0] fb_instbuffer_exception_cause1;
    wire [6:0] fb_instbuffer_exception_cause2;

    // é—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨ä¼´â€”éîå“é”åºé‚¯æ¤¤åº¢îšŠéŒæ¶¢å¹˜é—ç‚²î‡å©µî†¼ï¹¨å¨…ï½‰å¹‘é•îˆšÎ©é–µå¤›å¦‡æµœç‚´ä¿Šéî„â‚¬ã‚‰å´‘é›æ·¬â‚¬å†®å´¼éŠ‰ãƒ¦ç€¬å¦ã‚†æ´é‹æ’´ã„éŠï¼„æ‡‡é–¹ç¨¿ï¹¥å¯°å‹«ÎŸé¦î…î˜©é—‚å‚™æµ‡å®•å«æ…¨é‰æ‡¨æ´ªæ•ƒéŒæ°±î†‡é—è§„å„¼å¦«å‹¯å¼¸æ¸šâ‚¬éŒç†¼å¹‘é°é›æ®­å©µâ˜†å…é”•ãˆ¤å¼»é‡ãˆ é†‡æ¿ é›æµ‚å¦«ç‚²îœƒéŠˆå‘¯ç®°é–»æ §ã‚¸å¯®å©šæ•ƒéˆ§î„ƒç’ç¼‚å‚™ç„¦é¡­å›¬Ë‡æµ¼å­˜â’‘é‰ç‚´å£†é”å¶‰æŸŸéŸç‰ˆå–˜ç?µî‡…åŠéªæ¨¼ç´’å¦¯ç»˜î??
    wire iuncache;
    wire [1:0]ex_is_bj;
    wire [31:0]ex_pc1;
    wire [31:0]ex_pc2;
    wire [1:0]ex_valid;
    wire [1:0]ex_real_taken;
    wire [31:0]ex_real_addr1;
    wire [31:0]ex_real_addr2;
    wire [31:0]ex_pred_addr1;
    wire [31:0]ex_pred_addr2;
    wire get_data_req;
    wire [7:0] flush_o;
    wire [7:0] pause_o;

    // é—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨ä¼´â€”éîå“é”åºé‚¯æ¤¤åº¢îšŠéŒæ¶¢å¹˜é—ç‚²î‡å©µî†¼ï¹¨å¨…ï½‰å¹‘é•îˆšÎ©é–µå¤›å¦‡è¤°æ°¶æ¢ºç’ºã„¥æ«é–¹å‡¤æ‹·?? dcache é—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨å •å¼»é”å¤Šç®£é–¿æ¿†æ†›é¾ç»˜ç…›é–¸æ¶±å–—éŠæ„°æŸ¡çè¯²â‚¬æ¥…åŸ?é¡’ä½ºâŠ•é’ƒéæŸ£éŠŠï¹€ç´é–¹î†½Ç¹ç» æ¶šâ‚¬ï½äºœé¡«å›§Î”é˜é›ä»œç¼ç»˜ï¹¢å¯®î‚¦æ•“é”Ÿï¿??
    wire  backend_dcache_ren;
    wire [3:0]  backend_dcache_wen;
    wire [31:0] backend_dcache_addr;
    wire [31:0] backend_dcache_write_data;

    // dcache é—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨å •å¼»é”å¤Šç®£é–¿æ¿†æ†›é¾ç»˜ç…›é–¸æ¶±å–—éŠæ„°æŸ¡å®?å¬¬ç¯€ç€¹æ›Ÿå¸’é¡«æ»ˆå´¼é”å¥‰ä¼??é—‚ä½½æ³•é æ„°å¼¸æ¿ æ°¬ç®¯é–¿ç‡‚æ‹·?é—‚ä½½æ³•é æ›Î›é•î‚¬è?¿é—î„?ç§´ç» îˆæŸ£å¦¯æ¬¾åš™ç¼çŠµç²¯éŠ‡å‹¯å¼®é¥î®æ’´ç¹›é›î‚¢ç²æ¿®å©ƒæ¤½å®•î‚¦å´Ÿé¡ç†·äº¾é–¸î‚£æ´–çº¾å½’æŸ¡å®¥å‘¯ä»›éæ°¾æ‹??é—‚ä½½æ³•é æ›Î›é•î… ç¤Šå©µçŠ²æ´¤ç» æ¿â”‘é˜å‰æé–¸æ¥å¨ŠéŒæ›¡ç®›æ¿ å‚šâ’‰å©µç‚²æ‡Œé¨è—‰îé“è§„å´‰é–µå¨¿å„²éãˆ¤æ¢ºç’ºã„¥æ«é–¹å‡¤æ‹??
    wire [31:0] dcache_backend_rdata;
    wire dcache_backend_rdata_valid;
    wire dcache_ready;

    // dcache-AXI é—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨å •å¼»é”å¤Šç®£é–¿æ¿†æ†›é¾ç»˜ç…›é–¸æ¶±å–—éŠæ„°æŸ¡å®?å¬¬ç¯€ç€¹æ›Ÿå¸’é¡«æ»ˆå´¼é”å¥‰ä¼??é—‚ä½½æ³•é æ„°å¼¸æ¿ æ°¬ç®¯é–¿ç‡‚æ‹·??? cache é—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé–­ï¹?æŸé–ºå—˜ç²“éŒç†ºç´’éŠçŠ³çˆç¼‚ä½²å“ç?¹â‚¬é•î„‚å“é—å® æ¡¨ç»?ä¾?å¼³å¨†æ„©äºœéŸ«å›¨æŒ¾é©ï½†æ…¨æ¿ å‘®î é–¹ç‘°å«°æ¿¡æå¦·é””å¥ç°½é—‚å‚™ç¤é²ï¿ å¹é¼ä½¸Î§é–¹é—´ç¤ç» æ ¨ã„é‡ç‚´î—éæ°¾æ‹·?é—‚ä½½æ³•é æ›Ÿæ…¨éŠˆå¤‹æ™ªé—‚ä½½æ³•é£ï¹‚å¹é”Ÿï¿??
    wire dev_rrdy_to_cache;
    wire dev_wrdy_to_cache;

    wire duncache_rvalid;
    wire [31:0] duncache_rdata;
    wire  duncache_ren;
    wire [31:0] duncache_raddr;

    wire duncache_write_finish;
    wire duncache_wen;
    wire [31:0] duncache_wdata;
    wire [31:0] duncache_waddr;
    
    wire [31:0] new_pc_from_ctrl;
    wire [1:0] BPU_pred_taken;

    //é–¸æ°¬æµ·é¡î„„æƒƒé’î•™ré‰å ŸæŒ¸é™å—™ç´’å¦¾æ³ans_addré–»ã„¥å«ªæ·‡å©‡å´£é”Ÿï¿½
    wire [31:0] csr_dmw0;//dmw0é–¿æ¶˜æœ¬å©€ä¾?å¼«é«æ»…ç§´é–ºå‹­æ¢?27:25]é–¿æ¶˜è‹¯è¤°æŸ¥æ‡—é´æ”çª—å¨´ï½†ç²ˆç’ç†¼å¼µéˆ§î„„å´¥æ´ã‚†ç¥®é–¹å¹¿å¹é¤î…¢å¼¶éŠ‰Ñ„ç•±é–¸ï¸½æ¾˜å¨¼å†®æƒƒé•î„ä»˜å¦¤å‚›Ã¼ç»—ä½¹æ‹…é”Ÿï¿?
    wire [31:0] csr_dmw1;//dmw1é–¿æ¶˜æœ¬å©€ä¾?å¼«é«æ»…ç§´é–ºå‹­æ¢?27:25]é–¿æ¶˜è‹¯è¤°æŸ¥æ‡—é´æ”çª—å¨´ï½†ç²ˆç’ç†¼å¼µéˆ§î„„å´¥æ´ã‚†ç¥®é–¹å¹¿å¹é¤î…¢å¼¶éŠ‰Ñ„ç•±é–¸ï¸½æ¾˜å¨¼å†®æƒƒé•î„ä»˜å¦¤å‚›Ã¼ç»—ä½¹æ‹…é”Ÿï¿?
    wire        csr_da;
    wire        csr_pg;
    wire [1:0]  csr_plv;

    //trans_addr to dcache
    wire [31:0] ret_data_paddr;
    front u_front
    (
        // é—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨å •å¼»é”å¤Šç®£é–¿æ¿†æ†›é¾ç»˜ç…›é–¸æ¶±å–—éŠæ„°æŸ¡å®?å¬¬ç¯€ç€¹æ›Ÿå¸’é¡«æ»ˆå´¼é”å¥‰ä¼??é—‚ä½½æ³•é æ„°å¼¸æ¿ æ°¬ç®¯é–¿ç‡‚æ‹·???
        .cpu_clk(aclk),
        .cpu_rst(rst),

        .iuncache(iuncache),//é—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨ä¼´â€”éîå“é”åºç°¼é–¹ç™¸ç¶éŒã„©æ‚¤éŒæ¶˜î¶?é—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨å •å¼»é”å¤Šç®£é–¿æ¿†æ†›é¾ç»˜ç…›é–¸æ¶±å–—éŠæ„°æŸ¡çè¯²â‚¬æ¥…åŸ?é¡’ä½ºâŠ•é’ƒéæŸ£éŠŠï¹€ç´é–¹î†½Ç¹ç» æ¶šâ‚¬ï½äºœé¡«å›§Î”é˜é›ä»œç¼ç»˜ï¹¢éªå†¨â¿°é«ç†·æ®Ÿé—é›î™?é—„å‹¯î””é”å…¼â’’å¨´ï½…æ†¡é¯å ¥æŸ›æ¿ å‚œåŸ£ç?¹æ›ŸåŠ™å¯®ä»‹å´¹é¡ãˆ©ä¼??é—‚ä½½æ³•é æ’»å¼²é¡ï¹€ç® é–¹æî‡§é“æ©€æŸ›é°é›æŸé–ºå’ƒæ‹??       //(é—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨å •å¼»é”å¤Šç®£é–¿æ¿†æ†›é¾ç»˜ç…›é–¸æ¶±å½é²å“¥ç´’æˆã„¥æµ®é–¹å´‡å¨€é¡¢æ¥…åŸ?é¡’å‹¬å€¶å©µå¤Œîˆacheé—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸ¡é¥ãƒ¥ç©ç¼â‚¬é«æ¿ƒæ”½é–¸å±¾ç¢éŸç‚ºæŸ›ç?£î‚¤å¢µé–¹î†½îš…éˆ½å¤Šâ–é¡“Ñ‚é‚¯é–ºä½¹æ‡éæ’»æ•“é”Ÿï¿??)

        // é—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨å •å¼»é”å¤Šç®£é–¿æ¿†æ†›é¾ç»˜ç…›é–¸æ¶±å–—éŠæ„°æŸ¡å®?å¬¬ç¯€ç€¹æ›Ÿå¸’é¡«æ»ˆå´¼é”å¥‰ä¼??é—‚ä½½æ³•é æ„°å¼¸æ¿ æ°¬ç®¯é–¿ç‡‚æ‹·??? icache é—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨å •å¼»é”å¤Šç®£é–¿æ¿†æ†›é¾ç»˜ç…›é–¸æ¶±å–—éŠæ„°æŸ¡çè¯²â‚¬æ¥…åŸ?é¡’ä½ºâŠ•é’ƒéæŸ£éŠŠï¹€ç´é–¹î†½Ç¹ç» æ¶šâ‚¬ï½äºœé¡«å›§Î”é˜é›ä»œç¼ç»˜ï¹¢å¯®î‚¦æ•“é”Ÿï¿??
        .pred_taken(BPU_pred_taken),
        .pi_icache_is_exception1(pi_icache_is_exception1),      //é—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨å´‡æ§éºæ–¾æ²ªé–¹îˆ†å²?â‚¬ç¢¼cheé—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨å •å¼»é”å¤Šç®£é–¿æ¿†æ†›é¾ç»˜ç…›é–¸æ¶±å–—éŠæ„°æŸ¡å®?å¬¬ç¯€ç€¹æ›Ÿå¸’é¡«æ»ˆå´¼é”å¥‰ä¼??é—‚ä½½æ³•é æ„°å¼¸æ¿ æ°¬ç®¯é–¿ç‡‚æ‹·?é—‚ä½½æ³•é æ›Î›é•î… ç¤Šå©µçŠ²æ´¤é’ƒç†¼æŸ•æ¿ç‚¬æ«†é–¸å¬ªå«°éŒæ¶˜â˜‰å§—å å§›æ¿å¯¸å§ç?šæ¿îæ¥¦è£¤äº¹é–¹çƒ˜ç¹ƒé¡¥æ ­æ¢ºç»‹è·¨ç®²é–¿æ›˜å¹é¡•ï½‰î”•é”•â‚¬ç» å©šæ‚¹é¥Ñƒçº§æ¤¤ãƒ¦ç¹ˆå§Šæ´ªæ£ƒå¨‘æ°¬î•ºå©µâ˜†å…é¡¨å©‡ã€éƒå é†‡é–ºå›©å•¿é·æ´ªæŸ£é˜å……èˆªé–¸æ–¿çŸ‚å¯®æå¹‹é””ç•Œå¸é–»åº¯ç¶†æµœå •æ‚¡éç¢±æ®½é–»æ„¯å°™ç» å©šæŸŸé¡”ç•ŒçŸ’é–¹å´‡å¤æ¿¡çƒ½æ•‚ç»›å¬©æˆ·é—‚å‚šå?·ç»€ä¾?å¹–é¡ï¹?ç£¹é–¸î‚£æ´–çº¾å½’æŸ¡å®¥å‘¯ä»›éæ°¾æ‹??é—‚ä½½æ³•é æ›Î›é•î… ç¤Šå©µçŠ²æ´¤é’ƒç†¼æŸ•æ¿ç‚¬æ«†é–¸å¬ªå«°éŒæ¶˜â˜‰å§—å å§›æ¿å¯¸å§ç?šæ¿îå¨²î„æ¶æ¤¤æ’¶å›éªå¬®æ¢ºç›â?³äº¾é–ºå¤Šç‰„é”å²„î”šé”Ÿï¿½?
        .pi_icache_is_exception2(pi_icache_is_exception2),
        .pi_icache_exception_cause1(pi_icache_exception_cause1),  
        .pi_icache_exception_cause2(pi_icache_exception_cause2),
        .pc_for_buffer1(icache_pc1),
        .pc_for_buffer2(icache_pc2),
        .pred_addr_for_buffer(pred_addr_for_buffer),
        .pred_taken_for_buffer(pred_taken_for_buffer),
        .icache_pc_suspend(pc_suspend),
        .inst_for_buffer1(icache_inst1),
        .inst_for_buffer2(icache_inst2),
        .icache_inst_valid(icache_inst_valid),

    // *******************
        .fb_flush({flush_o[2],flush_o[0]}), //é—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨å •å¼»é”å¤Šç®£é–¿æ¿†æ†›é¾ç»˜ç…›é–¸æ¶±å–—éŠæ„°æŸ¡å®?å¬¬ç¯€ç€¹æ›Ÿå¸’é¡«æ»ˆå´¼é”å¥‰ä¼??é—‚ä½½æ³•é æ„°å¼¸æ¿ æ°¬ç®¯é–¿ç‡‚æ‹·?é—‚ä½½æ³•é æ›Î›é•î… ç¤Šå©µçŠ²æ´¤é’ƒç†¼æŸ•æ¿ç‚¬æ«†é–¸å¬ªå«°éŒæ¶˜â˜‰å§—å å§›æ¿å¯¸å§ç?šæ¿îæ¥¦è£¤äº¹é–¹çƒ˜ç¹ƒé¡¥æ ­æ¢ºç»‹è·¨ç®²é–¿æ›˜å¹é¡•ï½‰î”•é”•â‚¬ç» å©šæ‚¹é¥Ñƒçº§æ¤¤ãƒ¦ç¹ˆå§Šæ´ªæ£ƒå¨‘æ°¬î•ºå©µâ˜†å…é¡¨å©‡ã€éƒå é†‡é–ºå›©å•¿é·æ´ªæŸ£é˜å……èˆªé–¸æ–¿çŸ‚å¯®ç¨¿â–è¹‡å©ƒæ–€é—ç»˜åŠ•å¯®å •å´°å¦¯æ±‡äºœé–µå¿Šå‰éˆ·æ„°æŸŸé¡–æ¶™î—ˆå©µî†¹å“é—ç»˜ç‘¢é‹æ’³Ã¹éå…¼å´Œæ¿®å©„ç²¯é·å‘´æ‡éŠ‰Ñâ‚¬å©‡æ¢ºéãƒ¥Ğ£æ¿èŒ¬å––æ¿¡å­˜æ‹…ç»¯æ›ç‰šé—ç³•å‰éŸï¹‚æƒéƒå Ÿâ’’å¨“æ°£å“æ¿ä½³å›¨å‹é–¸â„ƒç‘¦å®•æŸ¥æŸŸé¼î…ç¡éæ°¾æ‹·?é—‚ä½½æ³•é æ›Î›é•î… ç¤Šå©µçŠ²æ´¤é’ƒç†¼æŸ•æ¿ç‚¬æ«†é–¸å¬ªå«°éŒæ¶˜â˜‰å§—å å§›æ¿å¯¸å§ç?šæ¿îæ¥¦è£¤äº¹é–¹çƒ˜ç¹ƒé¡¥æ ­æ¢ºç»‹è·¨ç®²é–¿æ›˜å¹é¡•ï½‰î”•é”•â‚¬ç» å©šæŸ¤é¼ä½¹æ¶§é–ºå—›äº¶å§Šè™¹ç´’å¦¯è¤î˜¥é—ç¨¿ï¹¨å®•ç”µåˆ’é«ç†·ç·ç?¹â‚¬éˆ§î„€Î›é¡–ç‚´ç…›å©¢è·ºîƒéãƒ¦ä¿Šé»æ”ç§ºé–¹î†½îš…é¡«æ¿‹î”—éŒæºã„©æ¢ºéå‹®î¦é–¸æ—?å¿éªå†®å§€éŠˆå‘¯î˜§é—ç¨¿ç¹’é˜Ñƒâ–å©µå¬«â’’å¨´ï½ˆæ«£ç”¯æ¶¢æŸ¤è¤°æ”ç•ºé–¹î†½æ¤½éˆ¥ï¹‚å¹’é¾æ„ä¼??é—‚ä½½æ³•é æ›Î›é•î… ç¤Šå©µçŠ²æ´¤é’ƒç†¼æŸ•æ¿ç‚¬æ«†é–¸å¬ªå«°éŒæ¶˜â˜‰å§—å å§›æ¿å¯¸å§ç?šæ¿îæ¥¦è£¤äº¹é–¹çƒ˜ç¹ƒé¡¥æ ­æ¢ºç»‹è·¨ç®²é–¿æ›˜å¹é¡•ï½‰î”•é”•â‚¬ç» å©šæŸ¤é¼ä½¹æ¶§é–ºå¬ªå?¿å§Šæ´ªå´·é¡“ç‚²å¦ºé—æåŠéææ‡æˆã„§ç¯€æ¿®æ©†å¾é˜ç”¸æ¢ºç¼æ¨ºç±å©µî†ºå?å¯®î‚¦æŸ†å®¥å—˜æ«¢é—è·¨å™¦é·ï¿½?é—‚ä½½î‰æ¾¹å—˜æ™¶å¦¤å‘®å‚é–µå¤†æ™œé“ç†¼æŸ¡éŒæ¶˜î‡œé–¸ç†ºå¤éŒï½ˆç®›é”å‘®çé—å“„ç¼é åº¨æ‚¾é”ŸçŠ²çº§é–¹ç¨¿å·©éˆºå‚œç®¾é–ºå¤‹åµé®æˆä¿Šé¡ãˆ æš£ç?µî†¼îŸ·æ¿¡æåŸ¡éŒæ°«ç°»é—‚ä½¹å„³ç»»æ¥…î”šéî¡è™¹èŠ±éŠä¹»hé—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸ¡é¥ãƒ¥ç©ç¼â‚¬é«æ¿ƒæ”½é–¸å±¾ç°±è¤°æ“å„—æ¿¡ã‚…æ‡é“æ›¢æŸŸç?›æ¨¼æ‡ƒé–³ÑŒå‰šé¡¨å ¢åˆ’éƒå é†‡é–ºå›©å–“é˜å«ä¿Šéå·®å„å¦¤çŠ³æ‚‚å®•ãˆ¤å¹˜é¡”ç•Œå¸æ¿è¾¾ç¶€é¡«å¤Œäº¸é¢å‘Šç…™é–¸æ¬î˜°çï¸½îš¥éæ‘ç¬’é“»æ §Ã¹é”å¤‹æ•±é–¸ç‚²î˜µå§Šç»˜æ‹…éãƒ§Ğ¨å¦ã‚ƒå„²é¹å›§ç•·å¦¤â‚¬é¡«æ»ˆåŸ?é¡’â‚¬é¡•ï½‰î”•é”•â‚¬ç» è¤ç´“æµ£å§‘î„â–“å¦¤â‚¬éˆ¹æˆ¦î”™é‚ã‚„ç·µé—å‘ŠæŒ»éŸï¸¾æ¢å¨‘ãˆ ç‚Šæ¤¤æèƒ¶é˜éæ¢ºéå‹­Ğ é–¸å©ƒæ´˜é…å •å¼»éŠ‰ï¹?â‚¬å«æ…¨å§—å——å¢°ç¼å¤‹æ¤½éŒï¼„ä»¦ç’‡æ’î‡é—è¯¡å–“é¨è—‰ç•·éŠŠï¸¾ç¯€é–¸æ›¨äºçº¾å—æ¢»éŒæ¬’å…Œé–¹è™«æ‡å®•æŸ¥å¼»éŠ‰ãƒ¥ç°¥é—å“„è¢«ééå´¹éŒæ»„å–é–»æ¥?ç‰†ç»—æ—æŸ›çè¯²å¦¼é–³è§„å¿é®â•ç•·é¥èˆµæ®¹é—‚ä½¸æ«é³å¿›å¹ƒéŒç‚²è“Ÿé–¿ç†ºå§´çº¾å…¼æ…¨å¦¤â‚¬é—å©„â‚¬æ°¾æ‹·?é—‚ä½½æ³•é æ„°å¼¸æ¿ æ°¬ç®¯é–¿ç‡‚æ‹·?é—‚ä½½æ³•é æ›Î›é•î… ç¤Šå©µçŠ²å€»é†ï¸½ç¹æ¿ å‚šæ¤é–¸æ°¬îƒ…é¡­è·¨æ„æ¸šîˆšå‰±å©µç‚²æ‡Œé¨è—‰îå¨²î„å·å©µçŠ²å•«çº¾â•â”‘éå·®æ§¹æ¿èŒ¬å––æ¿¡æ’®å´’éå­˜æ«¢é—è·¨å™¦é·ï¿½?æ¿¡ã‚‡å§·é‹æ¶šæ¢éºæ–¿åæ¿®æ©†åºç»»å—™â‚¬æ®¿å–—é—çŠ²îç¼æ¨»åª´é–¼æ’å„³éŠ†å©‡æ¢ºéãƒ¥Ğ£é–¸æ—?ç‘¥é¡•ï½‰å´¨æ¿ å‹­ç˜ˆå©µî†½ï¹©é“æ¶¢î”™é¡æ¶™â’‘ç¼‚ä½¹Ãªéåâ”‘é¡”å“„â‚¬æ¿†î‡£éŒãƒ¥ç®¹å¨´ï½…æ¹±é˜ææ¢ºç»‹æŒæ¹°é–¿æ›¨åŠéªå¿›æ•“é”Ÿï¿½?é—‚ä½½æ³•é æ„°å¼¸æ¿ æ°¬ç®¯é–¿ç‡‚æ‹·?é—‚ä½½æ³•é æ›Î›é•î‚¬è?¿é—î„?ç§µéå¤‹ã„è¹‡æ’¶å¢›é–»æ•åéˆ§î„€ç®éåÎ›å¨†å¿Šæé–µå¿‹å€–éˆ·æˆ¦æŸ›å©µå——î©é–³ÑŒå‰™é–ç…ç•·é°æ¿å†?é–¸îŸ‘å„é¡ï¿??é—‚ä½½æ³•é æ›Î›é•î… ç¤Šå©µçŠ²æ´¤é’ƒç†¼æŸ•æ¿ç‚¬æ«†é–¸å¬ªå«°éŒæ¶˜â˜‰å§—å å§›æ¿å¯¸å§ç?šæ¿îå¨²î…å¡é–ºå¤‹å¯§äº›é—‚ä½¹æ‚¶é¨é¸¿ãéî†½å©å¨´ï½…å•°é¤â‚¬å©µç‚´å¶éŸï¹‚å´•é¡å‘¬ç¹†é–µå ç¹’é’ä¼´æŸ›é•ä½¸ç¦ç€µî†½ç…¡å®•î‚¦å¦·è¤é”›æ»ˆæ¢ºé›å©„æ‡ƒæ¤¤ï¸»åµéˆªç®shé—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸ¡é¥ãƒ¥ç©ç¼â‚¬é«æ¿ƒæ”½é–¸å±¾ç°±è¤°æ“å„—æ¿¡ã‚‚å“æ¤¤î„å•°éˆ§î„Šç¶†æµœæ»ˆæƒéŠŠâ•‚ç…›é–¸â„ƒîŸ‡é­æ—æŸ¡å®?â‚¬é æ„°Ë‡é—å Ÿå„Ÿé–³ãƒ¥å•¿ç» ï½‰æ¢»æµ£èŠ¥ã€ƒé–»æç®“éªæˆ¦å´¶è¤œé¤æ›Ÿã„éºæˆî©é¥æ’®æ¢ºç»¯æ›å¢²æ¤¤ã„¥ç¹‘ç?µå¥¸å¹˜ç¼æ¨·æ‹»æ¿è¾¾ç¶?æ¿®ã‚‡æ¶µé«æ›Ÿç…•é–»æ¨¿æ«•å®•å²?â‚¬è§„æ´©ç»»æ¿‹ç®æ´ã„¦åšé–µå¤›é™„éæŠ½æ¢»æ¿ åº¡äºœæ¿è¯§ç®“å¯®å©šå¦¸éˆºå©ƒæ™œé—å‰²å…å¨²æ©€åŸ›é´ï¸½å£é–¹î…Ÿå¸’æ¿¡å¥¸æŸ¡ç€£î‚¢ç´é–ºå²‹ç´•éˆ§î„Šç¶†æµœå •æ‚¡éç¢±æ®½é–»æ„¯å°™ç» å©šæŸŸé¡”ç•ŒçŸ’é–¹å´‡å¤æ¿¡çƒ½æ•‚ç»›å¬©æˆ·é—‚å‚šå?·ç»€ä¾?å¹–é¡ï¹?ç£¹é–¸î‚£æ´–çº¾å½’æŸ¡å®¥å‘¯ä»›éæ°¾æ‹??é—‚ä½½æ³•é åº¨åŸ€é¡’å‚šæ«æ¿å…¼åŠ—ç»±æ”â‚¬ï½äº¶å¦¯â‚¬é—ç³•æ–é‹æ’³îœƒéŠˆå——ç¬’éæ°¼åƒé®ï¿ å¦·éˆºå‚œå½é—å“„å?¹ç?µÑ‡å´¯éçƒ˜ç…ŸéŸ«å›·çµ½å¨…å¶‰æŸ¡å®€â‚¬é åº¨æ‚¾é”ŸçŠ²çº§é–¹ç¨¿å·©éˆºä½„æ—ˆæ‚©é—ˆæ¶—æ²ªé—åœ­æ‡“å¨²î…î‡£æ¿ æ°¬Î©é–³å“„å?¸æµœæ»ˆæ¢ºé›å©„â˜‰é–¿æ›ªé™„ç€µå¥¸å´Ÿé¡–æ¶’æ‹ºéŸæ»…å¢—ç”¯â•Î›é´çƒ†æ®°æ¤¤å¿“æ£­å¦«æ¼®nt/pcé—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨å •å¼»é”å¤Šç®£é–¿æ¿†æ†›é¾ç»˜ç…›é–¸æ¶±å–—éŠæ„°æŸ¡å®?å¬¬ç¯€ç€¹æ›Ÿå¸’é¡«æ»ˆå´¼é”å¥‰ä¼??é—‚ä½½æ³•é æ„°å¼¸æ¿ æ°¬ç®¯é–¿ç‡‚æ‹·?é—‚ä½½æ³•é æ›Î›é•î… ç¤Šå©µçŠ²æ´¤é’ƒç†¼æŸ•æ¿ç‚¬æ«†é–¸å¬ªå«®éˆ§î„‚æ‡“ç?šî…îŸ¿å¦¯è‚©ç£½é–¹æƒ§å¢çº¾å¥¸æŸ£é°é›å¢¯ç¼è·ºå¼¶éŠ‡å‹¯æ•ƒéˆ§î„æƒ”å©Šå ç®¯é–¿ç‡‚æ‹·?é—‚ä½½æ³•é æ’»å¼²é¡ï¸½å©æ¤¤æ‘å«­éˆ·æˆ¦æŸ›å¨‘æ©ˆæ”»éå¿£å¾ç»±æ“å¾„æ¿ å‹­Ğ¨éæ®¿å™®é‹å©‡ç®å¦¯å…¼å«šé–¸æ¬î˜½å¦«ç†¼æ¢»æ¸šâ‚¬å¨¼Ñ‡æ‚§é¡æ¤¢æ¶˜Î”éœä½¹æ™œé—å‰²å…å¨²æ©€åŸ›é´ï¸½å£é–¹î…Ÿå¸’æ¿¡å¥¸æŸ¡ç€£î‚£â’’ç¼è¾¨å¸¡å®•æ‘îéµä½¹æ•ª_flush
        .fb_pause({pause_o[2],pause_o[0]}),
        .fb_interrupt(1'b0),       
//        .fb_new_pc(32'b0),
        .new_pc(new_pc_from_ctrl),

        .BPU_flush(BPU_flush),
        .pi_pc(inst_addr),
        .BPU_pred_addr(BPU_pred_addr),
        .inst_rreq_to_icache(inst_rreq),
        .pi_is_exception(pi_is_exception),
        .pi_exception_cause(pi_exception_cause),

        // é—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨å •å¼»é”å¤Šç®£é–¿æ¿†æ†›é¾ç»˜ç…›é–¸æ¶±å–—éŠæ„°æŸ¡å®?å¬¬ç§®å©µâ„ƒæ‚‚æ¿¡çƒ½æ•‚ç¼æ©ˆéªé—‚ä½½î‡§ç»»æ„®æ¢é«ãƒ¥ç¤‰é–¹è¾¾å¦‡å®“ä¾?ç…«é¥ã„§âŠ•é–¸å¬µäºéŠ‡å‹¯å¼½é¢é›åŸŒå©µç‚²ç‰œé¨è·ºîç¼æ¨»åª´é–¼æ’å„³éŠ†å©‡æ¢ºéãƒ¥Ğ£é–¸æ—€ç‘¥é¡•ï½‰å´¨æ¿ å‹­ç˜ˆå©µî†½ï¹©é“æ¶¢î”™é¡æ¶™â’‘æ¿®ç‘°æ´¤éˆ§îƒ¾å?å®•å½’æŸ†å®“ãƒ¥î˜¯éˆ»åº¨å¹˜ç»®è§„å«¼é—è¤å§µæµœä»‹å´çè§£æé–¹æ‰®å¢—é…ææŸ¨é•å‚›å«???
        .ex_is_bj(ex_is_bj),
        .ex_pc1(ex_pc1),
        .ex_pc2(ex_pc2),
        .ex_valid(ex_valid),
        .real_taken(ex_real_taken),
        .real_addr1(ex_real_addr1),
        .real_addr2(ex_real_addr2),
        .pred_addr1(ex_pred_addr1),
        .pred_addr2(ex_pred_addr2),
        .get_data_req(get_data_req),

        // é—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨å •å¼»é”å¤Šç®£é–¿æ¿†æ†›é¾ç»˜ç…›é–¸æ¶±å–—éŠæ„°æŸ¡å®?å¬¬ç¯€ç€¹æ›Ÿå¸’é¡«æ»ˆå´¼é”å¥‰ä¼??é—‚ä½½æ³•é æ„°å¼¸æ¿ æ°¬ç®¯é–¿ç‡‚æ‹·?é—‚ä½½æ³•é æ›Î›é•î… ç¤Šå©µçŠ²æ´¤é’ƒç†¼æŸ•æ¿ç‚¬æ«†é–¸å¬ªå«°éŒæ¶˜â˜‰å§—å å§›æ¿å¯¸å§ç?šæ¿îæ¥¦è£¤äº¹é–¹çƒ˜ç¹ƒé¡¥æ ­æ¢ºç»‹è·¨ç®²é–¿æ›˜å¹é¡•ï½‰î”•é”•â‚¬ç» å©šæ‚¹é¥î„çšºæ¤¤ï¸»åƒéŒï½‰æ‚©æˆî‚«åŠ…é—ç»˜æŒ¸é—æ’³î‡£éæµ‹å ªé–¸î‚¤å–“é˜å«ä¿Šéå·®å„å¦¤çŠ³æ‚‚å®•ãˆ¤å¹˜é¡”ç•Œå¸æ¿è¾¾ç¶€é¡«å¤Šç•·å®€å‹¬ç…™é–¾å¿£å€‹é¡å ¬ç¶–æ¿ é›îƒ…çº­â‚¬é—ç»˜åŠ•éæ°¶î”˜æ¿ æ°­â’’å¨´ï½‡å„¤é¤â‚¬é—æå?–é—çŠ»å¼«é¾ç»˜æ™¸é–¿ç‡‚æ‹·?
        .fb_pred_taken1(fb_pred_taken1),
        .fb_pred_taken2(fb_pred_taken2),
        .fb_pc_out1(fb_pc1),
        .fb_pc_out2(fb_pc2),
        .fb_inst_out1(fb_inst1),
        .fb_inst_out2(fb_inst2),
        .fb_valid(fb_valid),
        .fb_pre_branch_addr1(fb_pre_branch_addr1),
        .fb_pre_branch_addr2(fb_pre_branch_addr2),
        .fb_is_exception1(fb_is_exception1),
        .fb_is_exception2(fb_is_exception2),
        .fb_pc_exception_cause1(fb_pc_exception_cause1),
        .fb_pc_exception_cause2(fb_pc_exception_cause2),
        .fb_instbuffer_exception_cause1(fb_instbuffer_exception_cause1),
        .fb_instbuffer_exception_cause2(fb_instbuffer_exception_cause2)
    );


    backend u_backend(
        .clk(aclk),
        .rst(rst),

        // from outer
        .is_hwi(intrpt),
        
        // é—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨å •å¼»é”å¤Šç®£é–¿æ¿†æ†›é¾ç»˜ç…›é–¸æ¶±å–—éŠæ„°æŸ¡å®?å¬¬ç¯€ç€¹æ›Ÿå¸’é¡«æ»ˆå´¼é”å¥‰ä¼??é—‚ä½½æ³•é æ„°å¼¸æ¿ æ°¬ç®¯é–¿ç‡‚æ‹·?é—‚ä½½æ³•é æ›Î›é•î… ç¤Šå©µçŠ²å€»é†ï¸½ç¹æ¿ å‚šæ¤é–¸æ°¬îƒ…é¡­è·¨æ„æ¸šîˆšå‰±å©µç‚²æ‡Œé¨è—‰îå¨²î„å·å©µçŠ²å•«çº¾â•â”‘éå·®æ§¹æ¿èŒ¬å––æ¿¡æ’®å´’éå­˜æ«¢é—è·¨å™¦é·ï¿½?æ¿¡ã‚‡å§·é‹æ¶šæ¢å§—â‚¬éªå†¨â¿°é«ç†·æ®Ÿé—é›î™?é—„å‹¯î””é”å…¼â’’å¨´ï½…æ«ç”¯å •æŸ£æ³é”å²„ï½å©µå¬ªÎ©ç‘œå²„æ‚æ¿ å›¨ç…å©µç‚µå“å¨…å‘¯ç´’é™â‚¬é¨å •å¼«é¾ç»˜æ™¸é–¿ç‡‚æ‹???
        .new_pc(new_pc_from_ctrl),
        .pc_i1(fb_pc1),
        .pc_i2(fb_pc2),
        .inst_i1(fb_inst1),
        .inst_i2(fb_inst2),
        .valid_i(fb_valid),
        .pre_is_branch_taken_i({fb_pred_taken1,fb_pred_taken2}),
        .pre_branch_addr_i1(fb_pre_branch_addr1),
        .pre_branch_addr_i2(fb_pre_branch_addr2),
        .is_exception1_i(fb_is_exception1),
        .is_exception2_i(fb_is_exception2),
        .pc_exception_cause1_i(fb_pc_exception_cause1),
        .pc_exception_cause2_i(fb_pc_exception_cause2),
        .instbuffer_exception_cause1_i(fb_instbuffer_exception_cause1),
        .instbuffer_exception_cause2_i(fb_instbuffer_exception_cause2),

        .bpu_flush(BPU_flush),   // é—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨è·ºîå¨²î„å‚æ¤¤æ›æ‡é“éæ¢ºéå‹¬î—ç¼î†¼çŸéå¬®æ¢ºéå‹µæ§¸é–»å¿”ç¹ˆé¡¢æ—ˆî”˜éŠï¼„å¸æ¿è¾¾ç¶€é¡«å¤Šç•·å®€â‚¬éˆ§î„î†–é£î‡€å´œé”é•ç¹†é–¸î‚£æ´–éªãˆ¡ä¿ŠéŠˆå’ƒæ¢—ç¼æ†‹ç®“å§Šå©šå´’å¨†æ„®ã‚°å©µç‚²î˜°å¨²ç†·ç•·æµ¼æ‘ç®›é–ºå¤Šçé¤æˆç¹é¢é›Ğ£é–¼ç‘°å¢½ç»®å©šî”›éå¯¸å½é—ç¡…æªç»²å€Ÿî•¿é—‚ä½¸æ«é³å¿›å¹ƒéŒç‚²è“Ÿé–¿ç†ºå§´çº¾å…¼æ…¨å¦¤â‚¬é—å©„â‚¬æ°¾æ‹·?é—‚ä½½æ³•é æ„°å¼¸æ¿ æ°¬ç®¯é–¿ç‡‚æ‹·?é—‚ä½½æ³•é æ›Î›é•î… ç¤Šå©µçŠ²æ´¤é’ƒç†¼æŸ•æ¿ç‚¬æ«†é–¸å¬ªå«°éŒæ¶˜â˜‰å§—å å§›æ¿å¯¸å§ç?šæ¿îæ¥¦è£¤äº¹é–¹çƒ˜ç¹ƒé¡¥æ ­æ¢ºç»‹è·¨ç®²é–¿æ›˜å¹é¡•ï½‰î”•é”•â‚¬ç» å©šæ‚¹é¥Ñƒçº§æ¤¤ãƒ¦ç¹ˆå§Šæ´ªæ£ƒå¨‘æ°¬î•ºå©µâ˜†å…é¡¨å©‡ã€éƒå é†‡é–ºå›©å•¿é·æ´ªæŸ£é˜å……èˆªé–¸æ–¿çŸ‚å¯®æå¹‹é””ç•Œå¸é–»åº¯ç¶†æµœå •æ‚¡éç¢±æ®½é–»æ„¯å°™ç» å©šæŸŸé¡”ç•ŒçŸ’é–¹å´‡å¤æ¿¡çƒ½æ•‚ç»›å¬©æˆ·é—‚å‚šå?·ç»€ä¾?å¹–é¡ï¹?ç£¹é–¸î‚£æ´–çº¾å½’æŸ¡å®¥å‘¯ä»›éæ°¾æ‹??é—‚ä½½æ³•é æ›Î›é•î… ç¤Šå©µçŠ²æ´¤é’ƒç†¼æŸ•æ¿ç‚¬æ«†é–¸å¬ªæ£éŒæ¶šä»¦é“Ñ€æ§ˆå¦ã‚…éªé·ï¿½
    
        // é—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨å •å¼»é”å¤Šç®£é–¿æ¿†æ†›é¾ç»˜ç…›é–¸æ¶±å–—éŠæ„°æŸ¡å®?å¬¬ç¯€ç€¹æ›Ÿå¸’é¡«æ»ˆå´¼é”å¥‰ä¼??é—‚ä½½æ³•é æ„°å¼¸æ¿ æ°¬ç®¯é–¿ç‡‚æ‹·?é—‚ä½½æ³•é æ›Î›é•î… ç¤Šå©µçŠ²æ´¤é’ƒç†¼æŸ•æ¿ç‚¬æ«†é–¸å¬ªå«­ç»»æ¶¢æ‡ é¡’å‚šç¬¡é—ç¨¿îƒƒéç”¸å¼»é”å¤Šî…é–³è½°èƒ¶æµ¼å›¬æ¢ºéãƒ¥Ğ£æ¤¤ã„¦åŠ™éªå¿›æ•“é”Ÿï¿??é—‚ä½½æ³•é æ›Î›é•î‚¬è?¿é—î„?ç§´ç» îˆæŸ£å¦¯æ¬¾åš™ç¼çŠµç²¯éŠ‡å‹¯å¼®é¥î®æ’´ç¹›é›î‚¢ç²æ¿®å©ƒæ¤½å®•î‚¦å´Ÿé¡ç†·äº¾é–¸î‚£æ´–çº¾å½’æŸ¡å®¥å‘¯ä»›éæ°¾æ‹??é—‚ä½½æ³•é æ›Î›é•î… ç¤Šå©µçŠ²æ´¤ç» æ¿â”‘é˜å‰æé–¸æ¥å¨ŠéŒæ›¡ç®›æ¿ å‚šâ’‰å©µç‚²æ‡Œé¨è—‰îé“è§„å´‰é–µå¨¿å„²éãˆ¤æ¢ºç’ºã„¥æ«é–¹å‡¤æ‹??
        .ex_bpu_is_bj(ex_is_bj),
        .ex_pc1(ex_pc1),
        .ex_pc2(ex_pc2),
        .ex_valid(ex_valid),
        .ex_bpu_taken_or_not_actual(ex_real_taken),
        .ex_bpu_branch_actual_addr1(ex_real_addr1),  
        .ex_bpu_branch_actual_addr2(ex_real_addr2),
        .ex_bpu_branch_pred_addr1(ex_pred_addr1),
        .ex_bpu_branch_pred_addr2(ex_pred_addr2),
        .get_data_req_o(get_data_req),
        .csr_dmw0(csr_dmw0),
        .csr_dmw1(csr_dmw1),
        .csr_da(csr_da),
        .csr_pg(csr_pg),
        .csr_plv(csr_plv),

/*******************************
        .tlbidx(),
        .tlbehi(),
        .tlbelo0(),
        .tlbelo1(),
        .tlbelo1(),
        .asid(),
        .ecode(),

        .csr_datf(),
        .csr_datm(),
***********************************/

        // é—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨å •å¼»é”å¤Šç®£é–¿æ¿†æ†›é¾ç»˜ç…›é–¸æ¶±å–—éŠæ„°æŸ¡å®?å¬¬ç¯€ç€¹æ›Ÿå¸’é¡«æ»ˆå´¼é”å¥‰ä¼??é—‚ä½½æ³•é æ„°å¼¸æ¿ æ°¬ç®¯é–¿ç‡‚æ‹·?é—‚ä½½æ³•é æ›Î›é•î… ç¤Šå©µçŠ²æ´¤é’ƒç†¼æŸ•æ¿ç‚¬æ«†é–¸å¬ªæ£éŒæ¶šä»¦é“Ñ€æ§ˆå¦ã‚…éªé·ï¿½ dcache é—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨å •å¼»é”å¤Šç®£é–¿æ¿†æ†›é¾ç»˜ç…›é–¸æ¶±å–—éŠæ„°æŸ¡çè¯²â‚¬æ¥…åŸ?é¡’ä½ºâŠ•é’ƒéæŸ£éŠŠï¹€ç´é–¹î†½Ç¹ç» æ¶šâ‚¬ï½äºœé¡«å›§Î”é˜é›ä»œç¼ç»˜ï¹¢å¯®î‚¦æ•“é”Ÿï¿??
        .ren_o(backend_dcache_ren),
        .wstrb_o(backend_dcache_wen),
        .virtual_addr_o(backend_dcache_addr),
        .wdata_o(backend_dcache_write_data),

        // dcache é—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨å •å¼»é”å¤Šç®£é–¿æ¿†æ†›é¾ç»˜ç…›é–¸æ¶±å–—éŠæ„°æŸ¡å®?â‚¬é æ ­ç®éî…§æ•‡æ¿ é›ç‰Šé…å…¼ä¿Šéî„â‚¬Ñ…ç´é¡æ¶˜é—¯é–¿æ¿†î˜±å®“ä¾?ç…«é¥ã„§âŠ•é–¸å©‚îŸ·éŒã‚‰å¹éºæˆå§•å©µç‚²æ‡Œé¨è—‰îå¨²î…å‚é¼è¾¾çµ¾é²ç…â”‘é¡”è§’æ»ˆå´æ´ãˆ¢î›²é–¹é—´ç¤æƒŸé—å® æ¡¨é‘³å •î”™é¡æ¶™ç…¥é–»æ›å€¹ç?šï¿½??
        .rdata_i(dcache_rdata),
        .rdata_valid_i(dcache_backend_rdata_valid),
        .dcache_pause_i(~dcache_ready),

        // é—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨å´‡æ§éºæ–¾æ²ªç¼æ¶˜îƒ‚é‹æ’»åŸ€éŸâ‚¬lé—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨å •å¼»é”å¤Šç®£é–¿æ¿†æ†›é¾ç»˜ç…›é–¸æ¶±å–—éŠæ„°æŸ¡å®?å¬¬ç¯€ç€¹æ›Ÿå¸’é¡«æ»ˆå´¼é”å¥‰ä¼??é—‚ä½½æ³•é æ„°å¼¸æ¿ æ°¬ç®¯é–¿ç‡‚æ‹·?é—‚ä½½æ³•é æ›Î›é•î… ç¤Šå©µçŠ²æ´¤é’ƒç†¼æŸ•æ¿ç‚¬æ«†é–¸å¬ªå«°éŒæ¶˜â˜‰å§—å å§›æ¿å¯¸å§ç?šæ¿îæ¥¦è£¤äº¹é–¹çƒ˜ç¹ƒé¡¥æ ­æ¢ºéå‹®å«°æ¤¤ï¸»åµéå¬®æ¢ºéå‹«æš™é–»æ¥€ï¹ªå®•æˆ â‚¬ï½å†ç» é¹ƒæŸŸç?›æ¨¼æ‡ƒé–»å¿£äºªéŒï¿ å´¨é¡”è—‰â‚¬æ„°æŸ¡çè¯²å§‚é–¹î†ºå?å®•æ‘â˜‰å§—å—•ç´?8å©µçŠµæ•¸é‹çŠ»å¹“é¡å——ç·¤é–»ï½…ç¼é­æ’¶æ†¸é—å ç¬’é–ºå¬©ç·šéŒç†¼å¹‘é°é›æ®­å©µâ˜†å…é”•ãˆ¤å¼»é‡ãˆ é†‡æ¿ é›æµ‚å¦«ç‚ºæ¢ºç’ºã„¥æ«é–¹å‡¤æ‹·?
        .flush_o(flush_o),
        .pause_o(pause_o),
        
        //debug
        .debug_wb_valid1(debug_wb_valid1),
        .debug_wb_valid2(debug_wb_valid2),
        .debug_pc1(debug_pc1),
        .debug_pc2(debug_pc2),
        .debug_inst1(debug_inst1),
        .debug_inst2(debug_inst2),
        .debug_reg_addr1(debug_reg_addr1),
        .debug_reg_addr2(debug_reg_addr2),
        .debug_wdata1(debug_wdata1),
        .debug_wdata2(debug_wdata2),
        .debug_wb_we1(debug_wb_we1),
        .debug_wb_we2(debug_wb_we2) 
    );

    wire icache_ren_received;
    wire dcache_ren_received;
    wire icache_flush_flag_valid;

    icache u_icache
    (
        .clk(aclk),
        .rst(rst),   
        .flush(flush_o[1]),       
    // Interface to CPU
        .inst_rreq(inst_rreq),  // é—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨å •å¼»é”å¤Šç®£é–¿æ¿†æ†›é¾ç»˜ç…›é–¸æ¶±å–—éŠæ„°æŸ¡å®?å¬¬ç¯€ç€¹æ›Ÿå¸’é¡«æ»ˆå´¼é”å¥‰ä¼??é—‚ä½½æ³•é æ„°å¼¸æ¿ æ°¬ç®¯é–¿ç‡‚æ‹·?é—‚ä½½æ³•é æ’»å¼²é¡ï¸»æ•„ç?µã‚†ç´›é—‚å‚šå?¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨æŠ½åŸ?é¡’å‚›åš?éæ°¼å¼é¡­å®ÎŸé“åº£ç­é—ç§†å‹µæ®•é–»æ’´ç‘§ç»±æ”â‚¬ï½å„é¡•æ»ˆæŸ›é˜ç­¹è?¿é–ºå±¸å‰é·å‘¯æ†´é•î‚¤ï¼“é–»åº¢î†–é£î‡?å´œé”é•ç¹†é–¸î‚£æ´–éªãˆ¡ä¿ŠéŠˆå’ƒæ¢—ç¼æ†‹ç®“å§Šå©šå´’å¨†æ„®ã‚°å©µç‚²î˜°å¨²ç†·ç•·æµ¼æ‘ç®›é–ºå¤Šçé¤æˆç¹é¢é›Ğ£é–¼ç‘°å¢½ç»®å©šî”›éå­˜æ«¢é—è·¨å™¦é·ï¿???
        .inst_addr(inst_addr),      // é—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨å •å¼»é”å¤Šç®£é–¿æ¿†æ†›é¾ç»˜ç…›é–¸æ¶±å–—éŠæ„°æŸ¡å®?å¬¬ç¯€ç€¹æ›Ÿå¸’é¡«æ»ˆå´¼é”å¥‰ä¼??é—‚ä½½æ³•é æ„°å¼¸æ¿ æ°¬ç®¯é–¿ç‡‚æ‹·?é—‚ä½½æ³•é æ’»å¼²é¡ï¸»æ•„ç?µã‚†ç´›é—‚å‚šå?¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨æŠ½åŸ?é¡’å‚›åš?éæ°¼å¼é¡­å®ÎŸé“åº£ç­é—ç§†å‹µæ®•é–»æ’´ç‘§ç»±æ”â‚¬ï½å„é¡•æ»ˆæŸ›é˜ç­¹è?¿é–ºå±¸å‰é·å‘¯æ†´é•î‚¤ï¼“é–»åº¢î†–é£î‡?å´œé”é•ç¹†é–¸î‚£æ´–éªãˆ¡ä¿ŠéŠˆå’ƒæ¢—ç¼æ†‹ç®“å§Šç»˜ç¬Ÿéˆ§î„?îŸ‡æ¿ æ°¬ç®¯é–¿ç‡‚æ‹??é—‚ä½½æ³•é£ï¹‚å¹é”Ÿï¿½?
        .BPU_pred_addr(BPU_pred_addr),
        .BPU_pred_taken(BPU_pred_taken),

        .pi_is_exception(pi_is_exception),
        .pi_exception_cause(pi_exception_cause),

        .pred_addr(pred_addr_for_buffer),
        .pred_taken(pred_taken_for_buffer),
        .inst_valid(icache_inst_valid),     
        .inst_out1(icache_inst1),       
        .inst_out2(icache_inst2),
        .pc1(icache_pc1),
        .pc2(icache_pc2),
        .pc_is_exception_out1(pi_icache_is_exception1),
        .pc_is_exception_out2(pi_icache_is_exception2), 
        .pc_exception_cause_out1(pi_icache_exception_cause1),
        .pc_exception_cause_out2(pi_icache_exception_cause2),
        .pc_suspend(pc_suspend), 
    // Interface to Read Bus
        .dev_rrdy(dev_rrdy_to_cache),       
        .cpu_ren(icache_ren),       
        .cpu_raddr(icache_araddr),      
        .dev_rvalid(icache_rvalid),     
        .dev_rdata(icache_rdata),
        .ren_received(icache_ren_received),
        .flush_flag_valid(icache_flush_flag_valid)   
    );

    wire debug_wb_valid1;
    wire debug_wb_valid2;
    wire [31:0] debug_pc1;
    wire [31:0] debug_pc2;
    wire [31:0] debug_inst1;
    wire [31:0] debug_inst2;
    wire [4:0] debug_reg_addr1;
    wire [4:0] debug_reg_addr2;
    wire [31:0] debug_wdata1;
    wire [31:0] debug_wdata2;
    wire debug_wb_we1;
    wire debug_wb_we2;

    wire [3:0] duncache_wstrb;

    dcache u_dcache(
        .clk(aclk),
        .rst(rst),

        // é—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨å •å¼»é”å¤Šç®£é–¿æ¿†æ†›é¾ç»˜ç…›é–¸æ¶±å–—éŠæ„°æŸ¡å®?å¬¬ç§®å©µâ„ƒæ‚‚æ¿¡çƒ½æ•‚ç¼æ©ˆéªé—‚ä½½î‡§ç»»æ„®æ¢é«ãƒ¥ç¤‰é–¹è¾¾å¦‡å®“ä¾?ç…«é¥ã„§âŠ•é–¸å¬µäºéŠ‡å‹¯å¼½é¢é›åŸŒå©µç‚²ç‰œé¨è·ºîç¼æ¨»åª´é–¼æ’å„³éŠ†å©‡æ¢ºéãƒ¥Ğ£é–¸æ—€ç‘¥é¡•ï½‰å´¨æ¿ å‹­ç˜ˆå©µî†½ï¹©é“æ¶¢î”™é¡æ¶™â’‘æ¿®ç‘°æ´¤éˆ§îƒ¾å?å®•å½’æŸ†å®“ãƒ¥î˜¯éˆ»åº¨å¹˜ç»®è§„å«¼é—è¤å§µæµœä»‹å´çè§£æé–¹æ‰®å¢—é…ææŸ¨é•å‚›å«???
        .ren(backend_dcache_ren),
        .wen(backend_dcache_wen),
        .vaddr(backend_dcache_addr),
        .write_data(backend_dcache_write_data),

        // é—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨å •å¼»é”å¤Šç®£é–¿æ¿†æ†›é¾ç»˜ç…›é–¸æ¶±å–—éŠæ„°æŸ¡å®?å¬¬ç¯€ç€¹æ›Ÿå¸’é¡«æ»ˆå´¼é”å¥‰ä¼??é—‚ä½½æ³•é æ„°å¼¸æ¿ æ°¬ç®¯é–¿ç‡‚æ‹·?é—‚ä½½æ³•é æ›Î›é•î… ç¤Šå©µçŠ²æ´¤é’ƒç†¼æŸ•æ¿ç‚¬æ«†é–¸å¬ªå«°éŒæ¶˜â˜‰å§—å å§›æ¿å¯¸å§ç?šæ¿îæ¥¦è£¤äº¹é–¹çƒ˜ç¹ƒé¡¥æ ­æ¢ºç»‹è·¨ç®²é–¿æ›˜å¹é¡•ï½‰î”•é”•â‚¬ç» å©šæ‚¹é¥î„çšºæ¤¤ï¸»åƒéŒï½‰æ‚©æˆî‚«åŠ…é—ç»˜æŒ¸é—æ’³î‡£éæµ‹å ªé–¸î‚¤å–“é˜å«ä¿Šéå·®å„å¦¤çŠ³æ‚‚å®•ãˆ¤å¹˜é¡”ç•Œå¸æ¿è¾¾ç¶€é¡«å¤Šç•·å®€å‹¬ç…™é–¾å¿£å€‹é¡å ¬ç¶–æ¿ é›îƒ…çº­â‚¬é—ç»˜åŠ•éæ°¶î”˜æ¿ æ°­â’’å¨´ï½‡å„¤é¤â‚¬é—æå?–é—çŠ»å¼«é¾ç»˜æ™¸é–¿ç‡‚æ‹·?
        .rdata(dcache_rdata),
        .rdata_valid(dcache_backend_rdata_valid),    
        .dcache_ready(dcache_ready),  

    //to write BUS
        .dev_wrdy(dev_wrdy_to_cache),      
        .cpu_wen(dcache_wen),        
        .cpu_waddr(dcache_awaddr),      
        .cpu_wdata(dcache_wdata),      
    //to Read Bus
        .dev_rrdy(dev_rrdy_to_cache),       
        .cpu_ren(dcache_ren),        
        .cpu_raddr(dcache_araddr),      
        .dev_rvalid(dcache_rvalid),     
        .dev_rdata(dcache_axi_data_block),
        .ren_received(dcache_ren_received),
    //duncache to cache_axi
        .uncache_rvalid(duncache_rvalid),
        .uncache_rdata(duncache_rdata),
        .uncache_ren(duncache_ren),
        .uncache_raddr(duncache_raddr),

        //trans_addr to dcache
        .ret_data_paddr(ret_data_paddr),

        .uncache_write_finish(duncache_write_finish),
        .uncache_wen(duncache_wen),
        .uncache_wstrb(duncache_wstrb),
        .uncache_wdata(duncache_wdata),
        .uncache_waddr(duncache_waddr)  
    );
        
    addr_trans u_addr_trans(
        .clk(aclk),
        .rst(rst),
        .data_vaddr(backend_dcache_addr),
        .csr_da(csr_da),
        .csr_pg(csr_pg),
        .csr_dmw0(csr_dmw0),
        .csr_dmw1(csr_dmw1),
        .csr_plv(csr_plv),
        .ret_data_paddr(ret_data_paddr)
    );

    axi_interface u_axi_interface(
        .clk(aclk),
        .rst(rst),
    //connected to cache_axi
        .cache_ce(axi_ce_o),
        .cache_wen(axi_wen),   
        .cache_wsel(axi_wsel),      
        .cache_ren(axi_ren),         
        .cache_raddr(axi_raddr),
        .cache_waddr(axi_waddr),
        .cache_wdata(axi_wdata),
        .cache_rready(axi_rready),    
        .cache_wvalid(axi_wvalid),     
        .cache_wlast(axi_wlast),      
        .wdata_resp_o(axi_wdata_resp),    
    
        .cache_brust_type(cache_brust_type),  
        .cache_brust_size(cache_brust_size),
        .cacher_burst_length(axi_rlen),
        .cachew_burst_length(axi_wlen),

        .arid(arid),       
        .araddr(araddr),      
        .arlen(arlen),      
        .arsize(arsize),
        .arburst(arburst),
        .arlock(arlock),   
        .arcache(arcache),   
        .arprot(arprot),   
        .arvalid(arvalid),       
        .arready(arready),         
    //Ré—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨å •å¼»é”å¤Šç®£é–¿æ¿†æ†›é¾ç»˜ç…›é–¸æ¶±å–—éŠæ„°æŸ¡å®?å¬¬ç¯€ç€¹æ›Ÿå¸’é¡«æ»ˆå´¼é”å¥‰ä¼??é—‚ä½½æ³•é æ„°å¼¸æ¿ æ°¬ç®¯é–¿ç‡‚æ‹·?é—‚ä½½æ³•é æ›Î›é•î… ç¤Šå©µçŠ²æ´¤é’ƒç†¼æŸ•æ¿ç‚¬æ«†é–¸å¬ªå«°éŒæ¶˜â˜‰å§—å å§›æ¿å¯¸å§ç?šæ¿îå¨²î…å¡é–ºå¤‹å¯§é¡”â‚¬é—‚ä½½æ³•é£ï¹‚å¹é”Ÿï¿??
        .rid(rid),
        .rdata(rdata),   
        .rresp(rresp),    
        .rlast(rlast),           
        .rvalid(rvalid),       
        .rready(rready),
        .rdata_o(axi_rdata),
        .rdata_valid_o(axi_rdata_valid),         
    //AWé—‚å‚šå€·ç»€ä¾?å¹‰é”ŸçŠ²ç¤‰é–ºå¶å½é‹ï¿ æŸéå‹¬å™¹é–ºå¬©ç·šéŒç†¼å¹‘é°é›æ®­å©µâ˜†å…é”•ãˆ¤å¼»é‡ãˆ é†‡æ¿ é›æµ‚å¦«ç‚²îœƒéŠˆå‘¯ç®°é–»æ §ã‚¸å¯®è¯²â˜‰å©Šåº¢Ğ¥é—‚ä½½æ³•é£ï¹‚å¹é”Ÿï¿½?
        .awid(awid),     
        .awaddr(awaddr),  
        .awlen(awlen),    
        .awsize(awsize),   
        .awburst(awburst),
        .awlock(awlock),   
        .awcache(awcache),
        .awprot(awprot),   
        .awvalid(awvalid),        
        .awready(awready),        
    //Wé—‚å‚šå€·ç»€ä¾?å¹‰é”ŸçŠ²ç¤‰é–ºå¶å½é‹ï¿ æŸéå‹¬å™¹é–ºå¬©ç·šéŒç†¼å¹‘é°é›æ®­å©µâ˜†å…é”•ãˆ¤å¼»é‡ãˆ é†‡æ¿ é›æµ‚å¦«ç‚²îœƒéŠˆå‘¯ç®°é–»æ «å§é¡«å¿›æ¹ç‘™å‹«ç£¯é—é›Ç¹éæŸ¥æ‚—æ¥£å†©â’‘é–¸æ¿†å«·éå¿”ã„é¡“çŠ²å´é–»æ¶±å–›ç» æ¶˜â˜‰å¨†æ„­î??
        .wid(wid),     
        .wdata(wdata),  
        .wstrb(wstrb),    
        .wlast(wlast),          
        .wvalid(wvalid),       
        .wready(wready),         
    //é—‚å‚šå€·ç»€ä¾?å¹‰é”ŸçŠ²ç¤‰é–ºå¶å½é‹ï¿ æŸéå‹¬å™¹é–ºå¬©ç·šéŒç†¼å¹‘é°é›æ®­å©µâ˜†å…é”•ãˆ¤å¼»é‡ãˆ é†‡æ¿ é›æµ‚å¦«ç‚²îœƒéŠˆå‘¯ç®°é–»æ §ã‚¸é›î‡?å¼½éŠŠï¸¾ç§¶é—ç»˜åŠ¦é“æ¬“î””é”Ÿï¿½
        .bid(bid),      
        .bresp(bresp),    
        .bvalid(bvalid),        
        .bready(bready)         
    );

    cache_AXI u_cache_AXI(
        .clk(aclk),
        .rst(rst),    // low active

    //icache read
        .inst_ren_i(icache_ren),
        .inst_araddr_i(icache_araddr),
        .inst_rvalid_o(icache_rvalid),
        .inst_rdata_o(icache_rdata),
        .icache_ren_received(icache_ren_received),
        .icache_flush_flag_valid(icache_flush_flag_valid),

    //dcache read
        .data_ren_i(dcache_ren),
        .data_araddr_i(dcache_araddr),
        .data_rvalid_o(dcache_rvalid),
        .data_rdata_o(dcache_axi_data_block),
        .dcache_ren_received(dcache_ren_received),

    //dcache write
        .data_wen_i(dcache_wen),
        .data_wdata_i(dcache_wdata),
        .data_awaddr_i(dcache_awaddr),
        .data_bvalid_o(dcache_bvalid),

    //ready to cache
        .dev_rrdy_o(dev_rrdy_to_cache),
        .dev_wrdy_o(dev_wrdy_to_cache),

    //uncache to dcache
        .duncache_ren_i(duncache_ren),
        .duncache_raddr_i(duncache_raddr),
        .duncache_rvalid_o(duncache_rvalid),
        .duncache_rdata_o(duncache_rdata),

        .duncache_wen_i(duncache_wen),
        .duncache_wstrb(duncache_wstrb),
        .duncache_wdata_i(duncache_wdata),
        .duncache_waddr_i(duncache_waddr),
        .duncache_write_resp(duncache_write_finish),

    //AXI communicate
        .axi_ce_o(axi_ce_o),
        .axi_wsel_o(axi_wsel),   // é—‚å‚šå€¸éŠå³°Ã¹é¥Ñ€æ–é–ºå›¥å¹ç»æ¥…æŸŸé—å Ÿç·²é–¸æˆ å§´éˆ¹æˆ¦æ‚©ç€¹çŠ²î—ç¼‚ä½ºåª­é¨å •å¼»é”å¤Šç®£é–¿æ¿†æ†›é¾ç»˜ç…›é–¸æ¶±å–—éŠæ„°æŸ¡å®?å¬¬ç¯€ç€¹æ›Ÿå¸’é¡«æ»ˆå´¼é”å¥‰ä¼??é—‚ä½½æ³•é æ„°å¼¸æ¿ æ°¬ç®¯é–¿ç‡‚æ‹·?é—‚ä½½æ³•é æ›Î›é•î… ç¤Šå©µçŠ²æ´¤é’ƒç†¼æŸ•æ¿ç‚¬æ«†é–¸å¬ªå«°éŒæ¶˜â˜‰å§—å å§›æ¿å¯¸å§ç?šæ¿îæ¥¦è£¤äº¹é–¹çƒ˜ç¹ƒé¡¥æ ­æ¢ºç»‹è·¨ç®²é–¿æ›˜å¹é¡•ï½‰î”•é”•â‚¬ç» å©šæŸ›é¾èŒ¬î˜¦ç?¹æ›˜å„±é¡ªå†®å¦¶é¡æ¨ºæš—æ¿ æ®¿å¼é™å†¨î‡£éæµ‹å ªé–¸î‚¤å–“é˜å«ä¿Šéå·®å„éå«å¸¡é®ãˆ¤å´¡ç»«ç°‰b

    //AXI read
        .rdata_i(axi_rdata),
        .rdata_valid_i(axi_rdata_valid),
        .axi_ren_o(axi_ren),
        .axi_rready_o(axi_rready),
        .axi_raddr_o(axi_raddr),
        .axi_rlen_o(axi_rlen),

    //AXI write
        .wdata_resp_i(axi_wdata_resp),  // é—‚å‚šå€·ç»€ä¾?å¹‰é”ŸçŠ²ç¤‰é–ºå¶å½é‹ï¿ æŸéå‹¬å™¹é–ºå¬©ç·šéŒç†¼å¹‘é°é›æ®­å©µâ˜†å…é”•ãˆ¤å¼»é‡ãˆ é†‡æ¿ é›æµ‚å¦«ç‚²îœƒéŠˆå‘¯ç®°é–»æ §ã‚¸é›î‡?å¼½é¡ç†·äº¾æ¿æˆî°é´Î»å¤å´¼éŠ‰ï¸¾å¸æ¿è¾¾ç¶€é¡«å¤Šç•·å®€å‹¬ç…™é–¾å¿£å€‹é¡å ¬ç¶–æ¿ é›îƒ…çº­â‚¬é—ç»˜åŠ•éæ°¶î”˜æ¿ æ°­â’’å¨´ï½‡å„¤é¤â‚¬é—æå?–é—çŠ»å¼«é¾ç»˜æ™¸é–¿ç‡‚æ‹·?
        .axi_wen_o(axi_wen),
        .axi_waddr_o(axi_waddr),
        .axi_wdata_o(axi_wdata),
        .axi_wvalid_o(axi_wvalid),
        .axi_wlast_o(axi_wlast),
        .axi_wlen_o(axi_wlen)
    );


    wire [101:0] data1;
    wire [101:0] data2;
    wire valid1;
    wire valid2;
    wire [101:0] debug_data_out;
    wire debug_valid_out;

    assign data1 = {debug_wb_we1,debug_reg_addr1,debug_wdata1,debug_inst1,debug_pc1};
    assign data2 = {debug_wb_we2,debug_reg_addr2,debug_wdata2,debug_inst2,debug_pc2};
    assign valid1 = debug_wb_valid1;
    assign valid2 = debug_wb_valid2;

/*********************************************
    debug_FIFO debug
    (
        .clk(aclk),
        .rst(rst),
        .valid1(valid1),
        .data1(data1),
        .valid2(valid2),
        .data2(data2),
        .data_out(debug_data_out),
        .valid_out(debug_valid_out)
    );
***********************************************/


    assign debug0_wb_pc = debug_data_out[31:0];  
    assign debug0_wb_rf_wen = {4{debug_data_out[101]}};
    assign debug0_wb_rf_wnum = debug_data_out[100:96];
    assign debug0_wb_rf_wdata = debug_data_out[95:64];

endmodule